<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ù‡Ø§Ø±Ø§Øª Ù„ØºØªÙŠ Ø§Ù„Ù…Ù…ØªØ¹Ø©</title>
  <style>
    :root{
      --bg1:#f8fafc;
      --bg2:#eef2ff;
      --primary:#6d28d9;
      --primary2:#8b5cf6;
      --ink:#0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --shadow:0 18px 40px rgba(2,6,23,.10);
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      color:var(--ink);
      background: radial-gradient(1200px 600px at 30% -10%, #c4b5fd 0%, transparent 55%),
                  radial-gradient(900px 500px at 90% 0%, #93c5fd 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg2), var(--bg1));
      min-height:100vh;
    }

    /* Top bar */
    .topbar{
      background: linear-gradient(135deg, #7c3aed, #4f46e5);
      padding:14px 14px 18px;
      color:#fff;
      box-shadow: 0 14px 30px rgba(2,6,23,.15);
      position: sticky;
      top:0;
      z-index: 50;
    }
    .topbar-inner{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:220px;
    }
    .logo{
      width:46px;height:46px;
      border-radius:14px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.25);
      display:grid;place-items:center;
      font-size:22px;
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
    }
    .brand h1{
      margin:0;
      font-size:18px;
      line-height:1.2;
      letter-spacing:.2px;
    }
    .brand small{
      display:block;
      opacity:.92;
      margin-top:2px;
      font-size:12px;
      font-weight:600;
    }
    .navBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      border:none;
      cursor:pointer;
      padding:10px 14px;
      border-radius:16px;
      font-weight:800;
      color:#fff;
      background: rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.22);
      box-shadow: 0 10px 18px rgba(0,0,0,.15);
      transition: transform .15s ease, filter .15s ease;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .pill:hover{ transform: translateY(-2px); filter: brightness(1.04); }
    .pill:active{ transform: translateY(0); }
    .pill.primary{
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border:none;
    }

    /* Layout */
    .wrap{ max-width:1100px; margin:18px auto 40px; padding:0 14px; }
    .hintCard{
      background:rgba(255,255,255,.72);
      backdrop-filter: blur(10px);
      border:1px solid rgba(148,163,184,.25);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
      margin-bottom:18px;
    }
    .hintRow{
      display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap;
    }
    .hintRow .check{
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      background: #dcfce7;
      color:#166534;
      font-weight:900;
      flex:0 0 auto;
    }
    .hintRow p{ margin:0; color:#334155; font-weight:650; }

    /* Skills list */
    .skillsGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
      margin-bottom:18px;
    }
    @media(min-width:640px){ .skillsGrid{ grid-template-columns: 1fr 1fr; } }
    @media(min-width:980px){ .skillsGrid{ grid-template-columns: 1fr 1fr 1fr; } }
    .skillBtn{
      border:none;
      cursor:pointer;
      padding:18px 16px;
      border-radius: 999px;
      font-size:18px;
      font-weight:900;
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(148,163,184,.25);
      box-shadow: 0 16px 32px rgba(2,6,23,.10);
      transition: transform .15s ease, filter .15s ease, border-color .15s ease;
    }
    .skillBtn:hover{ transform: translateY(-2px); filter: brightness(1.02); border-color: rgba(99,102,241,.45); }
    .skillBtn.active{
      background: linear-gradient(135deg, #a78bfa, #60a5fa);
      color:#0b1220;
      border-color: rgba(99,102,241,.10);
    }

    /* Viewer */
    .viewer{
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border:1px solid rgba(148,163,184,.25);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:none;
    }
    .viewer.show{ display:block; }
    .viewerHead{
      padding:14px 16px;
      background: linear-gradient(135deg, #a78bfa, #60a5fa);
      color:#0b1220;
      font-weight:950;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .viewerHead .title{ font-size:18px; }
    .viewerBody{
      padding:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media(min-width:900px){
      .viewerBody{ grid-template-columns: 1.1fr .9fr; align-items:start; }
    }

    .skillImgWrap{
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(148,163,184,.25);
      box-shadow: 0 16px 30px rgba(2,6,23,.08);
      overflow:hidden;
      position:relative;
    }
    .skillImgWrap img{
      width:100%;
      display:block;
      cursor: zoom-in;
      transition: transform .22s ease;
    }
    .skillImgWrap img:hover{ transform: scale(1.01); }

    .actionBox{
      background: rgba(255,255,255,.9);
      border:1px solid rgba(148,163,184,.25);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 16px 30px rgba(2,6,23,.08);
    }
    .actionBox h3{
      margin:0 0 8px;
      font-size:16px;
      font-weight:950;
      color:#0f172a;
    }
    .actionBox p{
      margin:0 0 12px;
      color:#475569;
      font-weight:650;
      font-size:13px;
      line-height:1.6;
    }
    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .bigBtn{
      border:none;
      cursor:pointer;
      padding:12px 14px;
      border-radius:16px;
      font-weight:900;
      font-size:15px;
      box-shadow: 0 14px 26px rgba(2,6,23,.12);
      transition: transform .15s ease, filter .15s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .bigBtn:hover{ transform: translateY(-2px); filter: brightness(1.03); }
    .bigBtn:active{ transform: translateY(0); }
    .bigBtn.video{ background: linear-gradient(135deg,#4f46e5,#8b5cf6); color:#fff; }
    .bigBtn.quiz{ background: linear-gradient(135deg,#22c55e,#16a34a); color:#fff; }
    .bigBtn.disabled{ opacity:.55; cursor:not-allowed; filter:grayscale(.2); }

    .foot{
      text-align:center;
      color:#64748b;
      font-weight:700;
      margin-top:18px;
      font-size:13px;
    }
    .foot b{ color:#334155; }

    /* Modal */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:1000;
    }
    .modalOverlay.show{ display:flex; }
    .modal{
      width:min(980px, 96vw);
      max-height: 92vh;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(12px);
      border:1px solid rgba(148,163,184,.25);
      border-radius: 22px;
      box-shadow: 0 30px 70px rgba(0,0,0,.35);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .modalHeader{
      padding:12px 14px;
      background: linear-gradient(135deg, #a78bfa, #60a5fa);
      color:#0b1220;
      font-weight:950;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .modalHeader .mh-title{ font-size:16px; }
    .closeX{
      border:none;
      cursor:pointer;
      background: rgba(255,255,255,.28);
      border:1px solid rgba(255,255,255,.35);
      color:#0b1220;
      font-weight:950;
      padding:8px 12px;
      border-radius:14px;
      transition:transform .15s ease, filter .15s ease;
    }
    .closeX:hover{ transform: translateY(-2px); filter: brightness(1.04); }
    .closeX:active{ transform: translateY(0); }
    .modalBody{ padding:14px; overflow:auto; }

    /* TV Frame */
    .tv-frame{
      background: linear-gradient(180deg, #e0f2fe, #fff);
      border: 2px solid rgba(59,130,246,.25);
      border-radius: 26px;
      padding: 14px;
      box-shadow: 0 20px 40px rgba(2,6,23,.12);
      position:relative;
    }
    .tv-screen{
      border-radius: 18px;
      overflow:hidden;
      background:#0b1220;
      box-shadow: inset 0 0 0 6px rgba(255,255,255,.10);
    }
    .tv-screen iframe{
      width:100%;
      height: min(52vh, 430px);
      border:0;
      display:block;
      background:#0b1220;
    }
    @media(max-width:520px){ .tv-screen iframe{ height: 38vh; } }

    .tv-controls{
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .tv-btn{
      border:none;
      cursor:pointer;
      font-weight:900;
      padding:12px 16px;
      border-radius:16px;
      box-shadow:0 12px 22px rgba(0,0,0,.12);
      transition:transform .15s ease, filter .15s ease;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:15px;
    }
    .tv-btn:hover{ transform: translateY(-2px); filter:brightness(1.03); }
    .tv-btn:active{ transform: translateY(0); }
    .tv-btn.full{ background: linear-gradient(135deg,#1fb6ff,#7c3aed); color:#fff; }
    .tv-btn.close{ background: linear-gradient(135deg,#ef4444,#fb7185); color:#fff; }
    .tv-btn.open{ background: linear-gradient(135deg,#22c55e,#16a34a); color:#fff; }
    .tv-hint{
      text-align:center;
      font-size:13px;
      color:#475569;
      margin-top:8px;
      font-weight:750;
    }

    .small-btn{
      border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      font-weight:900;
      background: rgba(255,255,255,.85);
      border:1px solid rgba(148,163,184,.25);
      box-shadow: 0 12px 20px rgba(2,6,23,.10);
      transition: transform .15s ease, filter .15s ease;
    }
    .small-btn:hover{ transform: translateY(-2px); filter: brightness(1.02); }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:18px;
      background: rgba(15,23,42,.92);
      color:#fff;
      padding:12px 14px;
      border-radius:16px;
      font-weight:850;
      box-shadow: 0 18px 30px rgba(0,0,0,.25);
      display:none;
      z-index:1200;
      max-width:min(92vw, 560px);
      text-align:center;
    }
    .toast.show{ display:block; }

    /* Quiz */
    .quizWrap{
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(148,163,184,.25);
      box-shadow: 0 16px 30px rgba(2,6,23,.08);
      overflow:hidden;
    }
    .quizHead{
      padding:12px 14px;
      background: linear-gradient(135deg, #1fb6ff, #7c3aed);
      color:#fff;
      font-weight:950;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .quizBody{ padding:14px; }
    .qText{
      margin:0 0 12px;
      font-weight:950;
      color:#0f172a;
      line-height:1.8;
      font-size:16px;
    }
    .choices{ display:grid; gap:10px; }
    .choice{
      background: rgba(248,250,252,.9);
      border:1px solid rgba(148,163,184,.28);
      border-radius:16px;
      padding:12px;
      cursor:pointer;
      font-weight:900;
      transition: transform .12s ease, filter .12s ease;
    }
    .choice:hover{ transform: translateY(-2px); filter: brightness(1.02); }
    .choice.correct{ background:#dcfce7; border-color:#22c55e; }
    .choice.wrong{ background:#fee2e2; border-color:#ef4444; }
    .quizFooter{
      padding:12px 14px;
      border-top:1px dashed rgba(148,163,184,.35);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .progress{ font-weight:950; color:#334155; }
    .nextBtn{
      border:none; cursor:pointer;
      padding:10px 14px;
      border-radius:14px;
      font-weight:950;
      background: linear-gradient(135deg,#f59e0b,#fb7185);
      color:#fff;
      box-shadow: 0 12px 20px rgba(2,6,23,.12);
    }

    /* Mini table */
    .miniCard{
      background: rgba(255,255,255,.85);
      border:1px solid rgba(148,163,184,.25);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 16px 28px rgba(2,6,23,.08);
    }
    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:10px; border-bottom:1px solid rgba(148,163,184,.22); text-align:right; }
    th{ font-weight:950; color:#0f172a; background: rgba(99,102,241,.08); border-radius:12px; }
    tr:last-child td{ border-bottom:none; }
    .tag{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-weight:950;
      font-size:12px;
      background: rgba(34,197,94,.14);
      color:#166534;
      border:1px solid rgba(34,197,94,.25);
      margin-left:6px;
      white-space:nowrap;
    }
    .tag.gold{
      background: rgba(245,158,11,.18);
      color:#92400e;
      border-color: rgba(245,158,11,.30);
    }
  </style>
</head>
<body>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">ğŸŒŸ</div>
        <div>
          <h1>Ù…Ù‡Ø§Ø±Ø§Øª Ù„ØºØªÙŠ Ø§Ù„Ù…Ù…ØªØ¹Ø©</h1>
          <small>ØªØµÙ…ÙŠÙ…: ØµØ§Ù„Ø­Ø© Ø¹Ù„ÙŠ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</small>
        </div>
      </div>

      <div class="navBtns">
        <button class="pill" onclick="goHome()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="pill" onclick="openLeaderboard()">ğŸ† Ø§Ù„ØµØ¯Ø§Ø±Ø©</button>
        <button class="pill primary" onclick="openParent()">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hintCard">
      <div class="hintRow">
        <div class="check">âœ…</div>
        <p>
          <b>Ø§Ø®ØªØ± Ù…Ù‡Ø§Ø±Ø© (20 Ù…Ù‡Ø§Ø±Ø©)</b> â€” Ø«Ù… Ø³ØªØ¸Ù‡Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹
          <b>Ø²Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</b> Ùˆ<b>Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</b>. (Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ ØªÙ„ÙØ²ÙŠÙˆÙ† ÙƒØ±ØªÙˆÙ†ÙŠ + Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©)
        </p>
      </div>
    </section>

    <section id="skillsGrid" class="skillsGrid"></section>

    <section id="viewer" class="viewer">
      <div class="viewerHead">
        <div class="title" id="viewerTitle">â€”</div>
        <div style="font-weight:900;color:#0b1220;opacity:.92;font-size:13px">
          ğŸ¯ Ù†Ù‚Ø§Ø· + ÙƒØ£Ø³ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØªÙ‚Ø§Ù†
        </div>
      </div>

      <div class="viewerBody">
        <div class="skillImgWrap">
          <img id="viewerImg" src="" alt="Skill" onclick="openImageZoom()" />
        </div>

        <div class="actionBox">
          <h3>Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø¢Ù†</h3>
          <p>Ø´Ø§Ù‡Ø¯ÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ â€œØªÙ„ÙØ²ÙŠÙˆÙ†â€ Ø«Ù… Ø§Ù†ØªÙ‚Ù„ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±. Ø§Ù„Ø¯Ø±Ø¬Ø© ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØªØ¯Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© ğŸ†</p>
          <div class="btnRow">
            <button id="videoBtn" class="bigBtn video" onclick="openVideoModal(currentSkill)">ğŸ¬ ÙÙŠØ¯ÙŠÙˆ</button>
            <button id="quizBtn" class="bigBtn quiz" onclick="openQuiz(currentSkill)">ğŸ“ Ø§Ø®ØªØ¨Ø§Ø±</button>
          </div>
          <div style="margin-top:12px;color:#64748b;font-weight:800;font-size:13px">
            âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©: ØªÙƒØ¨ÙŠØ± (Zoom)
          </div>
        </div>
      </div>
    </section>

    <div class="foot">Â© Ù…Ù†ØµØ© <b>Ù„ØºØªÙŠ Ø§Ù„Ù…Ù…ØªØ¹Ø©</b> â€” Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªØµÙ…ÙŠÙ…: <b>ØµØ§Ù„Ø­Ø© Ø¹Ù„ÙŠ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</b></div>
  </main>

  <!-- Modal -->
  <div id="modalOverlay" class="modalOverlay" onclick="overlayClose(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modalHeader">
        <div class="mh-title" id="modalTitle">â€”</div>
        <button class="closeX" onclick="closeModal()">âœ–</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script>
    // =========================
    // 1) Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (20)
    // =========================
    const skills = [
      { id:"word_types", name:"Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø©", img:"image/skill_word_types.png", videos:["https://www.youtube.com/embed/CvTvx1TRYw4?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/CvTvx1TRYw4?feature=shared"] },
      { id:"verb_types", name:"Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙØ¹Ù„", img:"image/skill_verb-types.png", videos:["https://www.youtube.com/embed/-fNt_5kOvIs?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/-fNt_5kOvIs?feature=shared"] },
      { id:"title", name:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Øµ", img:"image/skill_title.png", videos:["https://www.youtube.com/embed/KWRbbfoP20c?rel=0&modestbranding=1&playsinline=1","https://www.youtube.com/embed/ZA0fn1a7VUg?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/KWRbbfoP20c?feature=shared","https://youtu.be/ZA0fn1a7VUg?feature=shared"] },
      { id:"tanween", name:"Ø§Ù„ØªÙ†ÙˆÙŠÙ†", img:"image/skill_tanween.png", videos:["https://www.youtube.com/embed/U3D7_jGq5NA?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/U3D7_jGq5NA?feature=shared"] },
      { id:"tafdeel", name:"Ø§Ø³Ù… Ø§Ù„ØªÙØ¶ÙŠÙ„", img:"image/skill_tafdeel.png", videos:["https://www.youtube.com/embed/pl5BGnN-Cdc?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/pl5BGnN-Cdc?feature=shared"] },
      { id:"taa", name:"Ø§Ù„ØªØ§Ø¡ Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø© ÙˆØ§Ù„Ù‡Ø§Ø¡", img:"image/skill_taa-skills.png", videos:["https://www.youtube.com/embed/R8fLZZjPZ6I?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/R8fLZZjPZ6I?feature=shared"] },
      { id:"synonyms", name:"Ø§Ù„Ù…Ø±Ø§Ø¯ÙØ§Øª", img:"image/skill_synonyms.png", videos:["https://www.youtube.com/embed/Ue9sNE6oF98?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/Ue9sNE6oF98?feature=shared"] },
      { id:"sun_moon", name:"Ø§Ù„Ù„Ø§Ù… Ø§Ù„Ø´Ù…Ø³ÙŠØ© ÙˆØ§Ù„Ù„Ø§Ù… Ø§Ù„Ù‚Ù…Ø±ÙŠØ©", img:"image/skill_sun-moon-lam.png", videos:["https://www.youtube.com/embed/3-B4xd83GXw?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/3-B4xd83GXw?feature=shared"] },
      { id:"sentence", name:"Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„Ù…ÙÙŠØ¯Ø©", img:"image/skill_sentence.png", videos:["https://www.youtube.com/embed/4NxjcMu9kV4?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/4NxjcMu9kV4?si=4qQ3a3gJmn24yYzo"] },
      { id:"punctuation", name:"Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ…", img:"image/skill_punctuation.png", videos:["https://www.youtube.com/embed/BpVqfG4LbCc?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/BpVqfG4LbCc?feature=shared"] },
      { id:"number", name:"Ø§Ù„Ù…ÙØ±Ø¯ ÙˆØ§Ù„Ù…Ø«Ù†Ù‰ ÙˆØ§Ù„Ø¬Ù…Ø¹", img:"image/skill_number.png", videos:["https://www.youtube.com/embed/fAdCP1qmLR0?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/fAdCP1qmLR0?feature=shared"] },
      { id:"main_idea", name:"Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³Ø©", img:"image/skill_main_idea.png", videos:["https://www.youtube.com/embed/jhuaaQjiZIs?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/jhuaaQjiZIs?feature=shared"] },
      { id:"mad", name:"Ø­Ø±ÙˆÙ Ø§Ù„Ù…Ø¯", img:"image/skill_mad-letters.png", videos:["https://www.youtube.com/embed/MbTOjRgayT0?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/MbTOjRgayT0?feature=shared"] },
      { id:"gender", name:"Ø§Ù„Ù…Ø°ÙƒØ± ÙˆØ§Ù„Ù…Ø¤Ù†Ø«", img:"image/skill_gender.png", videos:["https://www.youtube.com/embed/ufdUobvMz-E?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/ufdUobvMz-E?feature=shared"] },
      { id:"fael_mafool", name:"Ø§Ø³Ù… Ø§Ù„ÙØ§Ø¹Ù„ ÙˆØ§Ø³Ù… Ø§Ù„Ù…ÙØ¹ÙˆÙ„", img:"image/skill_fael-mafool.png", videos:[], videoLinks:[] },
      { id:"exception", name:"Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡", img:"image/skill_exception.png", videos:["https://www.youtube.com/embed/_l3t_vDpIJE?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/_l3t_vDpIJE?feature=shared"] },
      { id:"compare", name:"Ø£ÙˆØ¬Ù‡ Ø§Ù„Ø´Ø¨Ù‡ ÙˆØ§Ù„Ø§Ø®ØªÙ„Ø§Ù", img:"image/skill_compare.png", videos:["https://www.youtube.com/embed/ySR-1AgoQPY?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/ySR-1AgoQPY?feature=shared"] },
      { id:"antonyms", name:"Ø§Ù„Ø£Ø¶Ø¯Ø§Ø¯", img:"image/skill_antonyms.png", videos:["https://www.youtube.com/embed/kqTJtHz8U-Y?rel=0&modestbranding=1&playsinline=1"], videoLinks:["https://youtu.be/kqTJtHz8U-Y?feature=shared"] },
      { id:"text_parts", name:"Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©", img:"image/skill_text_parts.png", videos:[], videoLinks:[] },
    ];

    let currentSkill = null;

    // =========================
    // 2) Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ (LocalStorage)
    // =========================
    const LS_KEYS = {
      name: "laghati_student_name_v1",
      results: "laghati_results_v1",      // list of attempts
      stats: "laghati_stats_v1"           // aggregated stats
    };

    function nowISO(){ return new Date().toISOString(); }

    function getStudentName(){
      return (localStorage.getItem(LS_KEYS.name) || "").trim();
    }

    function ensureStudentName(){
      let n = getStudentName();
      if(!n){
        n = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙÙŠ Ø§Ù„ØµØ¯Ø§Ø±Ø©:", "Ø·Ø§Ù„Ø¨");
        if(n && n.trim()){
          localStorage.setItem(LS_KEYS.name, n.trim());
          toast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù… âœ…");
        }else{
          toast("Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…. Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ø³Ù…: Ø·Ø§Ù„Ø¨");
          localStorage.setItem(LS_KEYS.name, "Ø·Ø§Ù„Ø¨");
          n = "Ø·Ø§Ù„Ø¨";
        }
      }
      return n;
    }

    function loadJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        return JSON.parse(raw);
      }catch(e){
        return fallback;
      }
    }

    function saveJSON(key, data){
      localStorage.setItem(key, JSON.stringify(data));
    }

    function getResults(){
      return loadJSON(LS_KEYS.results, []);
    }

    function getStats(){
      // stats per student (we support multiple names on same device)
      return loadJSON(LS_KEYS.stats, {});
    }

    // Ù†Ù‚Ø§Ø· + ÙƒØ£Ø³:
    // - Ø§Ù„Ù†Ù‚Ø§Ø· = Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© (score)
    // - Ø¥Ø°Ø§ Ø§Ù„Ø¯Ø±Ø¬Ø© ÙƒØ§Ù…Ù„Ø© => ÙƒØ£Ø³ +1 + bonus Ù†Ù‚Ø§Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) = +2
    function calcAward(score, total){
      const full = score === total;
      const points = score + (full ? 2 : 0); // bonus Ù„Ù„Ù…ØªÙ‚Ù†
      const cups = full ? 1 : 0;
      return { points, cups, full };
    }

    function recordAttempt({student, skillId, skillName, score, total}){
      const results = getResults();
      const stats = getStats();
      const award = calcAward(score, total);

      // add attempt
      results.push({
        student,
        skillId,
        skillName,
        score,
        total,
        points: award.points,
        cups: award.cups,
        full: award.full,
        at: nowISO()
      });
      saveJSON(LS_KEYS.results, results);

      // aggregate per student
      if(!stats[student]){
        stats[student] = { points:0, cups:0, tests:0, lastAt: null };
      }
      stats[student].points += award.points;
      stats[student].cups += award.cups;
      stats[student].tests += 1;
      stats[student].lastAt = nowISO();
      saveJSON(LS_KEYS.stats, stats);
    }

    function formatDate(iso){
      try{
        const d = new Date(iso);
        return d.toLocaleString("ar-SA", {hour12:true});
      }catch(e){ return iso; }
    }

    function resetAllData(){
      localStorage.removeItem(LS_KEYS.results);
      localStorage.removeItem(LS_KEYS.stats);
      toast("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª âœ…");
    }

    function changeStudentName(){
      const oldName = getStudentName();
      const n = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:", oldName || "Ø·Ø§Ù„Ø¨");
      if(n && n.trim()){
        localStorage.setItem(LS_KEYS.name, n.trim());
        toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… âœ…");
      }
    }

    function leaderboardRows(){
      const stats = getStats();
      const entries = Object.entries(stats).map(([name, s])=>({name, ...s}));

      // ØªØ±ØªÙŠØ¨: Ù†Ù‚Ø§Ø· Ø«Ù… ÙƒØ¤ÙˆØ³ Ø«Ù… Ø£Ø­Ø¯Ø«
      entries.sort((a,b)=>{
        if(b.points !== a.points) return b.points - a.points;
        if(b.cups !== a.cups) return b.cups - a.cups;
        return (b.lastAt||"").localeCompare(a.lastAt||"");
      });

      if(entries.length===0){
        return `<div style="color:#475569;font-weight:850;line-height:1.9">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±Ø¬Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.<br/>Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªØ¨Ø§Ø±Ù‹Ø§ Ø«Ù… Ø¹ÙØ¯ Ø¥Ù„Ù‰ Ø§Ù„ØµØ¯Ø§Ø±Ø© ğŸ†
        </div>`;
      }

      return `
        <div class="miniCard">
          <table>
            <thead>
              <tr>
                <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù†Ù‚Ø§Ø· â­</th>
                <th>Ø§Ù„ÙƒØ¤ÙˆØ³ ğŸ†</th>
                <th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</th>
                <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
              </tr>
            </thead>
            <tbody>
              ${entries.map((e,i)=>`
                <tr>
                  <td><b>${i+1}</b></td>
                  <td>${e.name}</td>
                  <td><span class="tag">${e.points}</span></td>
                  <td><span class="tag gold">${e.cups}</span></td>
                  <td>${e.tests}</td>
                  <td style="color:#475569;font-weight:800">${e.lastAt ? formatDate(e.lastAt) : "â€”"}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      `;
    }

    function parentSummaryHTML(){
      const name = ensureStudentName();
      const stats = getStats();
      const s = stats[name] || {points:0,cups:0,tests:0,lastAt:null};

      const all = getResults().filter(r=>r.student===name).slice(-12).reverse();
      const list = all.length ? `
        <div class="miniCard" style="margin-top:12px">
          <div style="font-weight:950;margin-bottom:10px">Ø¢Ø®Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
          <table>
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</th>
                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                <th>ÙƒØ£Ø³</th>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              </tr>
            </thead>
            <tbody>
              ${all.map(r=>`
                <tr>
                  <td>${r.skillName}</td>
                  <td><b>${r.score}</b> / ${r.total}</td>
                  <td><span class="tag">${r.points}</span></td>
                  <td>${r.cups ? "ğŸ†" : "â€”"}</td>
                  <td style="color:#475569;font-weight:800">${formatDate(r.at)}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      ` : `<div style="margin-top:10px;color:#475569;font-weight:850">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>`;

      return `
        <div class="hintCard" style="margin:0">
          <div style="font-weight:950;font-size:16px;margin-bottom:10px">Ù…ØªØ§Ø¨Ø¹Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</div>
          <div style="color:#475569;font-weight:850;line-height:1.9">
            Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <b>${name}</b>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
            <span class="tag">Ø§Ù„Ù†Ù‚Ø§Ø·: ${s.points} â­</span>
            <span class="tag gold">Ø§Ù„ÙƒØ¤ÙˆØ³: ${s.cups} ğŸ†</span>
            <span class="tag">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: ${s.tests}</span>
          </div>

          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
            <button class="tv-btn open" onclick="changeStudentName()">âœï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…</button>
            <button class="tv-btn close" onclick="resetAllData(); openParent();">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button class="tv-btn full" onclick="openLeaderboard()">ğŸ† Ø¹Ø±Ø¶ Ø§Ù„ØµØ¯Ø§Ø±Ø©</button>
          </div>

          ${list}
        </div>
      `;
    }

    // =========================
    // 3) Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    // =========================
    const skillsGrid = document.getElementById("skillsGrid");
    const viewer = document.getElementById("viewer");
    const viewerTitle = document.getElementById("viewerTitle");
    const viewerImg = document.getElementById("viewerImg");
    const videoBtn = document.getElementById("videoBtn");

    function renderSkills(){
      skillsGrid.innerHTML = "";
      skills.forEach(s=>{
        const b = document.createElement("button");
        b.className = "skillBtn";
        b.textContent = s.name;
        b.onclick = ()=> selectSkill(s.id);
        skillsGrid.appendChild(b);
      });
    }

    function selectSkill(id){
      currentSkill = skills.find(x=>x.id===id);
      [...document.querySelectorAll(".skillBtn")].forEach(btn=>{
        btn.classList.toggle("active", btn.textContent===currentSkill.name);
      });

      viewerTitle.textContent = currentSkill.name;
      viewerImg.src = currentSkill.img;
      viewerImg.alt = currentSkill.name;

      const hasVideo = currentSkill.videos && currentSkill.videos.length>0;
      videoBtn.classList.toggle("disabled", !hasVideo);
      videoBtn.disabled = !hasVideo;
      if(!hasVideo){
        videoBtn.onclick = ()=>toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.");
      }else{
        videoBtn.onclick = ()=>openVideoModal(currentSkill);
      }

      viewer.classList.add("show");
      setTimeout(()=> viewer.scrollIntoView({behavior:"smooth", block:"start"}), 200);
    }

    // =========================
    // 4) Ø§Ù„ØªÙ†Ù‚Ù„
    // =========================
    function goHome(){ window.location.href = "index.html"; }

    function openLeaderboard(){
      // Ù„Ø§ Ù†Ø·Ù„Ø¨ Ø§Ø³Ù… Ù‡Ù†Ø§Ø› Ø§Ù„ØµØ¯Ø§Ø±Ø© ØªØ¹Ø±Ø¶ ÙƒÙ„ Ù…Ù† ØªÙ… Ø­ÙØ¸Ù‡Ù… Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²
      openModal("ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© (Ù†Ù‚Ø§Ø· + ÙƒØ¤ÙˆØ³)", `
        <div class="hintCard" style="margin:0">
          <div style="font-weight:950;font-size:16px;margin-bottom:8px">ğŸ–ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ¯Ø§Ø±Ø©</div>
          <div style="color:#475569;font-weight:850;line-height:1.9">
            â€¢ Ø§Ù„Ù†Ù‚Ø§Ø· â­ ØªÙØ­Ø³Ø¨ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¬Ø© + Ù…ÙƒØ§ÙØ£Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØªÙ‚Ø§Ù† (Ø§Ù„Ø¯Ø±Ø¬Ø© ÙƒØ§Ù…Ù„Ø©).<br/>
            â€¢ ÙƒØ£Ø³ ğŸ† Ø¹Ù†Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.<br/>
            â€¢ Ø§Ù„Ø­ÙØ¸ ÙŠØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„).
          </div>
        </div>
        <div style="margin-top:12px">${leaderboardRows()}</div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px">
          <button class="tv-btn full" onclick="openParent()">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</button>
          <button class="tv-btn close" onclick="resetAllData(); openLeaderboard();">ğŸ§¹ ØªØµÙÙŠØ± ÙƒÙ„ Ø§Ù„ØµØ¯Ø§Ø±Ø©</button>
        </div>
      `);
    }

    function openParent(){
      openModal("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±", parentSummaryHTML());
    }

    // =========================
    // 5) Modal
    // =========================
    const modalOverlay = document.getElementById("modalOverlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");

    function openModal(title, bodyHTML){
      modalTitle.textContent = title;
      modalBody.innerHTML = bodyHTML;
      modalOverlay.classList.add("show");
    }
    function closeModal(){
      modalOverlay.classList.remove("show");
      modalBody.innerHTML = "";
    }
    function overlayClose(e){ if(e.target === modalOverlay) closeModal(); }

    // =========================
    // 6) Toast
    // =========================
    let toastTimer=null;
    function toast(msg){
      const t=document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer=setTimeout(()=>t.classList.remove("show"), 2200);
    }

    // =========================
    // 7) ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
    // =========================
    function openImageZoom(){
      if(!currentSkill) return;
      openModal("ğŸ” " + currentSkill.name, `
        <div style="display:grid;place-items:center">
          <img src="${currentSkill.img}" alt="${currentSkill.name}"
               style="max-width:100%;border-radius:18px;box-shadow:0 18px 40px rgba(0,0,0,.18)">
        </div>
      `);
    }

    // =========================
    // 8) ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ ØªÙ„ÙØ²ÙŠÙˆÙ†
    // =========================
    function openVideoModal(skill){
      if(!skill.videos || skill.videos.length===0){
        toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.");
        return;
      }
      const makeTV = (url) => `
        <div class="tv-frame">
          <div class="tv-screen">
            <iframe id="tvIframe"
              src="${url}"
              title="Skill Video"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen></iframe>
          </div>

          <div class="tv-controls" role="group" aria-label="Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
            <button class="tv-btn full" onclick="toggleTVFullscreen()" type="button">â›¶ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
            <button class="tv-btn open" onclick="openVideoInNewTab()" type="button">ğŸ”— ÙØªØ­ ÙÙŠ ÙŠÙˆØªÙŠÙˆØ¨</button>
            <button class="tv-btn close" onclick="closeModal()" type="button">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
          </div>

          <div class="tv-hint">ğŸ“º Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ© â€” Ø§Ø³ØªØ®Ø¯Ù…ÙŠ â€œÙ…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©â€ Ù„Ø¹Ø±Ø¶ Ø£ÙˆØ¶Ø­.</div>
        </div>
      `;

      const switches = (skill.videos.length>1)
        ? `<div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px">
             ${skill.videos.map((v,i)=>`<button class="small-btn" onclick="switchVideo(${i})" type="button">ğŸ¬ ÙÙŠØ¯ÙŠÙˆ ${i+1}</button>`).join("")}
           </div>`
        : "";

      openModal(`ÙÙŠØ¯ÙŠÙˆ: ${skill.name}`, makeTV(skill.videos[0]) + switches);

      window.__currentVideoSkill = skill;
      window.__currentVideoIndex = 0;
    }

    function switchVideo(i){
      const skill = window.__currentVideoSkill;
      if(!skill || !skill.videos) return;
      window.__currentVideoIndex = i;
      const url = skill.videos[i];
      const f = document.getElementById("tvIframe");
      if(f) f.src = url;
    }

    function toggleTVFullscreen(){
      const el = document.querySelector(".tv-screen");
      if(!el) return;
      if(document.fullscreenElement){
        document.exitFullscreen?.();
        return;
      }
      el.requestFullscreen?.();
    }

    function openVideoInNewTab(){
      const skill = window.__currentVideoSkill;
      if(!skill) return;
      const i = window.__currentVideoIndex || 0;
      const link = (skill.videoLinks && skill.videoLinks[i]) ? skill.videoLinks[i] : (skill.videoLinks?.[0] || "");
      if(link) window.open(link, "_blank");
      else {
        const f = document.getElementById("tvIframe");
        if(f && f.src) window.open(f.src, "_blank");
      }
    }

    // =========================
    // 9) Ø§Ø®ØªØ¨Ø§Ø± + Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ù„Ù„ØµØ¯Ø§Ø±Ø©
    // =========================
    function openQuiz(skill){
      ensureStudentName(); // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø§Ø³Ù… Ù…Ø­ÙÙˆØ¸ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

      const questions = buildQuestions(skill);
      let idx=0;
      let score=0;

      const renderQ = ()=>{
        const q = questions[idx];
        openModal(`ğŸ“ Ø§Ø®ØªØ¨Ø§Ø±: ${skill.name}`, `
          <div class="quizWrap">
            <div class="quizHead">
              <div>Ø§Ù„Ø³Ø¤Ø§Ù„ ${idx+1} / ${questions.length}</div>
              <div class="progress">Ø§Ù„Ø¯Ø±Ø¬Ø©: ${score}</div>
            </div>
            <div class="quizBody">
              <p class="qText">${q.q}</p>
              <div class="choices">
                ${q.choices.map((c,i)=>`<div class="choice" onclick="pick(${i})">${c}</div>`).join("")}
              </div>
            </div>
            <div class="quizFooter">
              <div style="color:#64748b;font-weight:850">Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§Ø­Ø¯Ø©</div>
              <button class="nextBtn" onclick="next()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            </div>
          </div>
        `);

        window.pick = (i)=>{
          const choiceEls = [...document.querySelectorAll(".choice")];
          choiceEls.forEach(el=>el.onclick=null);

          if(i === q.correct){
            score += 1;
            playSound("correct");
            choiceEls[i].classList.add("correct");
            toast("âœ… Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ğŸ‰");
          }else{
            playSound("wrong");
            choiceEls[i].classList.add("wrong");
            choiceEls[q.correct].classList.add("correct");
            toast("âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰â€¦ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±");
          }
          const pr = document.querySelector(".progress");
          if(pr) pr.textContent = "Ø§Ù„Ø¯Ø±Ø¬Ø©: " + score;
        };

        window.next = ()=>{
          if(idx < questions.length-1){
            idx++;
            renderQ();
          }else{
            // Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            playSound("finish");

            const total = questions.length;
            const student = ensureStudentName();
            recordAttempt({
              student,
              skillId: skill.id,
              skillName: skill.name,
              score,
              total
            });

            const award = calcAward(score, total);
            const cup = award.full ? "ğŸ† ÙƒØ£Ø³ Ø§Ù„Ø¥ØªÙ‚Ø§Ù†!" : (score >= Math.ceil(total*0.7) ? "ğŸ¥‡ Ù…Ù…ØªØ§Ø²" : "â­ Ø¬ÙŠØ¯");
            const bonusTxt = award.full ? " (Ù…ÙƒØ§ÙØ£Ø© +2 Ù†Ù‚Ø§Ø·)" : "";

            openModal("ğŸ‰ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±", `
              <div class="hintCard" style="margin:0;text-align:center">
                <div style="font-weight:950;font-size:20px">${cup}</div>

                <div style="margin-top:8px;font-weight:950;font-size:18px;color:#0f172a">
                  Ø¯Ø±Ø¬ØªÙƒ: ${score} / ${total}
                </div>

                <div style="margin-top:10px;color:#475569;font-weight:900;line-height:1.9">
                  ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø§Ù„ØµØ¯Ø§Ø±Ø© âœ…<br/>
                  Ù†Ù‚Ø§Ø·Ùƒ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©: <b>${award.points}</b> â­${bonusTxt}
                </div>

                <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px">
                  <button class="tv-btn full" onclick="openLeaderboard()">ğŸ† Ø§Ù„ØµØ¯Ø§Ø±Ø©</button>
                  <button class="tv-btn open" onclick="openParent()">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</button>
                  <button class="tv-btn close" onclick="closeModal()">âœ… Ø­Ø³Ù†Ù‹Ø§</button>
                </div>
              </div>
            `);
          }
        };
      };

      renderQ();
    }

    function buildQuestions(skill){
      // Ø£Ø³Ø¦Ù„Ø© Ø¹Ø§Ù…Ø© â€œÙˆØ§Ù‚Ø¹ÙŠØ©â€ â€” ÙˆÙŠÙ…ÙƒÙ† Ù„Ø§Ø­Ù‚Ø§Ù‹ ØªØ®ØµÙŠØµ Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ù…Ù‡Ø§Ø±Ø©
      return [
        { q: "Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ ØªÙØ¹ÙØ¯Ù‘Ù (ÙØ¹Ù„Ù‹Ø§):", choices: ["Ù…Ø¯Ø±Ø³Ø©", "ÙŠÙ‚Ø±Ø£Ù", "Ù‚Ù„Ù…", "ØµØ¯ÙŠÙ‚"], correct: 1 },
        { q: "Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ ØªÙØ¹ÙØ¯Ù‘Ù (Ø§Ø³Ù…Ù‹Ø§):", choices: ["ÙŠÙƒØªØ¨Ù", "Ù…Ù†", "Ø§Ù„ÙƒØªØ§Ø¨Ù", "Ø³ÙˆÙ"], correct: 2 },
        { q: "Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:", choices: ["Ø§Ù„Ø·Ø§Ù„Ø¨Ù ÙŠÙƒØªØ¨Ù Ø§Ù„ÙˆØ§Ø¬Ø¨Ù.", "ÙŠÙƒØªØ¨Ù Ø§Ù„Ø·Ø§Ù„Ø¨Ù.", "Ø§Ù„ÙˆØ§Ø¬Ø¨Ù ÙŠÙƒØªØ¨.", "Ù…Ù† Ø¥Ù„Ù‰ ÙÙŠ"], correct: 0 },
        { q: "Ø§Ø®ØªØ± Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø¤Ø§Ù„:", choices: ["ØŸ", "ØŒ", "!", "Ø›"], correct: 0 },
        { q: "Ø£ÙŠÙ‘ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠÙ‡Ø§ (Ø­Ø±Ù Ù…Ø¯ Ø¨Ø§Ù„Ø§Ù„Ù):", choices: ["Ù‚Ù„Ù…", "ÙƒØªØ§Ø¨", "Ø¯Ø±Ø³", "Ø¨ÙŠØª"], correct: 1 },
      ];
    }

    // =========================
    // 10) Ø£ØµÙˆØ§Øª ÙˆØ§Ø¶Ø­Ø©
    // =========================
    function playSound(type){
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);

        if(type==="correct"){ o.frequency.value = 880; g.gain.value = 0.18; }
        else if(type==="wrong"){ o.frequency.value = 220; g.gain.value = 0.20; }
        else { o.frequency.value = 660; g.gain.value = 0.16; }

        o.type = "sine";
        o.start();
        setTimeout(()=>{ o.stop(); ctx.close(); }, type==="finish" ? 480 : 240);
      }catch(e){}
    }

    // init
    renderSkills();
  </script>
</body>
</html>
